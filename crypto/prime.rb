require 'gmp'

def main
    p = GMP::Z.new('134078079299425970995740249982058461274793658205923933' + \
                   '77723561443721764030073546976801874298166903427690031' + \
                   '858186486050853753882811946569946433649006084171')
    g = GMP::Z.new('11717829880366207009516117596335367088558084999998952205' + \
                   '59997945906392949973658374667057217647146031292859482967' + \
                   '5428279466566527115212748467589894601965568')
    h = GMP::Z.new('323947510405045044356526437872806578864909752095244' + \
                   '952783479245297198197614329255807385693795855318053' + \
                   '2878928001494706097394108577585732452307673444020333')
    b = GMP::Z.new(2 ** 20)

    ht = Hash.new()
    (0 .. 2**20).each do |x1|
        ht[(g.powmod(x1, p).invert(p) * h) % p] = x1
    end

    gb = g.powmod(b, p)
    (0 .. 2**20).each do |x0|
        rhs = gb.powmod(x0, p)
        if ht.has_key?(rhs)
            x1 = ht[rhs]
            x = (x0 * b + x1) % p
            puts x
            return
        end
    end
end

main
